<%= vuelidate_form_with model: resource, html: {class: "centered", method: :put}, vue: {name: resource_name}, url: registration_path(resource_name) do |f| %>
  <h2><%= t_action(".account_settings") %></h2>
  <%= render  "profiles/fields", f: f, profile: resource, show_name: resource.pronoun.present? do |p| %>
    <%= f.text_field(:uid, {tooltip: true}) unless resource.pronoun.nil? %>
    <%= f.check_box :opt_in, {tooltip: true} %>
  <% end %>
  <% if resource.pronoun.present? %>
    <h2 class="with-desc"><%= t_action(".security_settings.title") %></h2>
    <p class="description"><%= t_action(".security_settings.desc") %></p>
    <%= f.password_field :current_password, validate: true %>
    <%= f.text_field :email, autocomplete: "email" unless resource.pronoun.nil? %>
    <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
      <div>Currently waiting confirmation for: <%= resource.unconfirmed_email %></div>
    <% end %>
    <%= f.password_field :password, validate: true, required: false %>
    <%= f.password_field :password_confirmation, show_toggle: true, validate: true, required: false %>
  <% end %>
  <%= f.submit %>
<% end %>

<% if resource.pronoun.present? %>
  <%= vuelidate_form_with scope: :account_delete, html: {class: "centered", method: :delete}, vue: {name: :account_delete}, url: registration_path(resource_name) do |f| %>
    <h2 class="with-desc">Delete your account</h2>
    <p class="description">If you opted in to have your data used anonymously for research, we will clear your identifying information and keep the rest of your activity. If you want it all to be deleted from our servers, please opt out first.</p>
    <%= f.password_field :current_password, required: true, show_toggle: true %>
    <%= f.submit "Delete my account" %>
  <% end %>

  <%= link_to "Back", :back %>
<% end %>
